// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(cuid())
  email             String
  password          String?
  firstName         String?
  lastName          String?
  phoneNumber       String?
  businessName      String?
  businessType      String?
  address           String?
  whatsappNumber    String?
  directChatMessage String?
  role              String    @default("user") // user, admin, customer
  isActive          Boolean   @default(true)
  isDeleted         Boolean   @default(false) // New field for soft delete
  emailVerified     DateTime?
  image             String?

  // Essential fields
  subscriptionExpirationDate DateTime?
  subscriptionLtv   Float     @default(0.00)
  subscriptionPlan  String?
  subscriptionStartDate DateTime?
  termsAccepted     Boolean   @default(false)
  subscriptionStatus String   @default("active")
  
  // Stripe integration
  stripeCustomerId  String?   @unique
  stripeSubscriptionId String?
  
  // Referral system
  referralCode      String?   @unique

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  qrCodes           QRCode[]
  qrCodeScans       QRCodeScan[] // QR code scan history
  supportTickets    SupportTicket[]
  emailVerifications EmailVerification[]
  passwordResets    PasswordReset[]
  
  // Customer relations
  customers         Customers[]      // New customers table relation
  appointments      Appointment[]    // Appointments relation
  customerUsers     CustomerUser[]   // Customer-User relations
  paymentWebhooks   PaymentWebhook[] // Payment webhook relations
  paymentHistory    PaymentHistory[] // Payment history tracking
     reviews           Review[]         // Reviews received by business owner
   conversationStates ConversationState[] // WhatsApp conversation states
   whatsappMessages  whatsappMessage[] // WhatsApp messages sent by business owner
   customerStatusLogs CustomerStatusLog[] // Customer status change logs
   staff              Staff[]           // Staff members for this business
   services           Service[]         // Services for this business
   categories         Category[]        // Categories for this business
   catalogCategories  CatalogCategory[] // Catalog categories for this business
   suppliers          Supplier[]        // Suppliers for this business
   products           Product[]         // Products in catalog for this business
   waitlists          Waitlist[]        // Waiting list entries for calendar
   businessOperatingHours BusinessOperatingHours[] // Business operating hours
   businessGalleries   BusinessGallery[] // Business gallery images (Cloudinary)
   clientPermissions  ClientPermissions? // Client booking permissions (one per user)
   automations       Automations?       // Automation toggles (one per user)

  // üëá compound unique constraints
  @@unique([email, isDeleted])
  @@unique([businessName, isDeleted])
  @@map("users")
}

// Email verification tokens
model EmailVerification {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("email_verifications")
}

// Password reset tokens
model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_resets")
}

model QRCode {
  id                String   @id @default(cuid())
  userId            String
  name              String
  url               String
  qrData            String
  qrCodeImage       String?  // Store the generated QR code image as data URL
  messageForCustomer String? // Custom message for customers
  directMessage     String?  // Direct message for WhatsApp/contact
  directUrl         String?  // Direct URL for business
  messageUrl        String?  // Message URL for customers
  isActive          Boolean  @default(true)
  scanCount         Int      @default(0)
  shareCount        Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  scans QRCodeScan[] // Relationship to scan records

  @@map("qr_codes")
}

// QR Code Scan tracking model
model QRCodeScan {
  id          String   @id @default(cuid())
  qrCodeId    String
  userId      String   // Business owner who owns the QR code
  referrer    String?  // Where the scan came from (URL, app, etc.)
  userAgent   String?  // Browser/device information
  ipAddress   String?  // IP address of the scanner
  scanData    String?  // Additional data from the scan
  sharedata   String?  // Data related to sharing
  scanTime    DateTime @default(now())
  
  // Relations
  qRCode      QRCode   @relation(fields: [qrCodeId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("qr_code_scans")
}

model SupportTicket {
  id          String   @id @default(cuid())
  userId      String
  subject     String
  description String
  status      String   @default("open") // open, in_progress, resolved, closed
  priority    String   @default("medium") // low, medium, high, urgent
  category    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("support_tickets")
}

// New Customers table - Simple customer information
model Customers {
  id              String   @id @default(cuid())
  
  // Basic fields
  firstName       String?  // First name
  lastName        String?  // Last name
  email           String?  // Customer email address
  
  // Client required fields
  customerPhone   String?  // Customer phone number
  appointmentCount Int?     @default(0) // Number of appointments
  customerFullName String? // Full name in Hebrew/Arabic
  selectedServices String? // Selected services
  endDate         DateTime? // Appointment end date
  duration        String?  // Appointment duration
  startDate       DateTime? // Appointment start date
  businessId      Int?     // Business ID
  employeeId      Int?     // Employee ID
  businessName    String?     // Business Name
  
  // Location fields
  address         String?  // Customer address
  city            String?  // Customer city
  
  // Personal information
  birthdate       DateTime? // Customer birthdate
  
  // Image fields
  profileImage    String?  // Profile image URL
  coverImage      String?  // Cover image URL
  documentImage   String?  // Document image URL
  
  // Relations
  userId          String?  // Reference to User table (business owner)
  user            User?    @relation(fields: [userId], references: [id])
  appointments    Appointment[] // Appointments relation
  customerUsers   CustomerUser[] // Customer-User relations
  paymentWebhooks PaymentWebhook[] // Payment webhook relations
     reviews         Review[] // Reviews given by customer
   conversationStates ConversationState[] // WhatsApp conversation states
   whatsappMessages whatsappMessage[] // WhatsApp messages for this customer
   customerStatusLogs CustomerStatusLog[] // Customer status change logs
   waitlists         Waitlist[]         // Waiting list entries for this customer
  
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("customers")
} 

// Appointment status: booked, cancelled, scheduled
enum AppointmentStatus {
  booked
  cancelled
  scheduled
}

// Appointment table - Store webhook appointment data
model Appointment {
  id              String   @id @default(cuid())
  
  // Webhook data fields
  source          String?
  endDate         DateTime?
  duration        String?
  startDate       DateTime?
  createDate      DateTime?
  customerNote    String?  // Customer note for the appointment
  
  // Appointment status: booked, cancelled, scheduled
  appointmentStatus AppointmentStatus @default(booked)
  
  // Recurring: service type (e.g. Every Day, Every Week) and repeat duration (e.g. 1 Week, 2 Months)
  recurringType     String?  // SERVICE TYPE: Regular Appointment | Every Day | Every Week | Every 2 Weeks | Every Month | Every 2 Months
  recurringDuration String?  // REPEAT FOR: 1 Week | 2 Weeks | 1 Month | 2 Months
  recurringGroupId  String?  // Same for all appointments in one recurring series (used for "cancel entire series")

  // Queue: date/time when this appointment was created (e.g. when user created a queue appointment)
  queueTimeDate     DateTime?

  // Relations
  customerId      String?  // Reference to Customers table
  customer        Customers? @relation(fields: [customerId], references: [id])
  userId          String?  // Reference to User table (business owner)
  user            User?    @relation(fields: [userId], references: [id])
  
  // New relations for Staff and Service
  staffId         String?  // Reference to Staff table
  staff           Staff?   @relation(fields: [staffId], references: [id])
  serviceId       String?   // Reference to Service table
  service        Service?  @relation(fields: [serviceId], references: [id])
  
  // Related payments
  payments        PaymentWebhook[] // Payments for this appointment
  
  // Related reviews
  reviews         Review[] // Reviews for this appointment
  
  // Timestamps
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@map("appointments")
}

// Customer_User table - Customer and User relations
model CustomerUser {
  id          String   @id @default(cuid())
  customerId  String   // Reference to Customers table
  userId      String   // Reference to User table
  status      String   @default("active") // active, inactive, blocked
  isActive    Boolean  @default(true) // Customer active status for this user
  isDeleted   Boolean  @default(false) // Soft delete flag for customer-user relation
  
  // Relations
  customer    Customers @relation(fields: [customerId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("customer_users")
}

// Customer Status Logs - Track status changes over time
model CustomerStatusLog {
  id          String   @id @default(cuid())
  customerId  String   // Reference to Customers table
  userId      String   // Reference to User table
  oldStatus   String?  // Previous status (can be null for first record)
  newStatus   String   // New status
  reason      String?  // Reason for status change
  changedAt   DateTime @default(now()) // When the status changed
  
  // Relations
  customer    Customers @relation(fields: [customerId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("customer_status_logs")
}

// Conversation State table - Store WhatsApp conversation states
model ConversationState {
  id              String   @id @default(cuid())
  phoneNumber     String   @unique // Customer phone number
  customerName    String?  // Customer name
  step            String   // Conversation step: initial_sent, followup_sent, etc.
  lastMessage     String?  // Last message sent
  customerResponse String? // Customer response type: yes, no, unknown
  status          String   @default("at_risk") // Conversation type: at_risk, at_lost, at_review
  conversationEnded Boolean @default(false) // Is conversation completed
  
  // Timestamps
  startTime       DateTime @default(now()) // When conversation started
  followupTime    DateTime? // When follow-up was sent
  responseTime    DateTime? // When customer responded
  closureTime     DateTime? // When conversation ended
  
  // Relations
  userId          String?  // Reference to User table (business owner)
  customerId      String?  // Reference to Customers table
  user            User?    @relation(fields: [userId], references: [id])
  customer        Customers? @relation(fields: [customerId], references: [id])
  
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("conversation_states")
}

// New Payment model for webhook data
model PaymentWebhook {
  id                String   @id @default(cuid())
  
  // Payment details
  total             Float    @default(0.00)
  totalWithoutVAT   Float    @default(0.00)
  totalVAT          Float    @default(0.00)
  
  // Customer and Business references
  customerId        String?  // Reference to Customers table (EmployeeId)
  customer          Customers? @relation(fields: [customerId], references: [id])
  userId            String?  // Reference to User table (BusinessId)
  user              User?    @relation(fields: [userId], references: [id])
  
  // Appointment tracking
  appointmentId     String?  // Reference to Appointment table
  appointment       Appointment? @relation(fields: [appointmentId], references: [id])
  
  // Review tracking
  reviews           Review[] // Reviews triggered by this payment
  
  // Additional fields
  paymentDate       DateTime @default(now())
  status            String   @default("success") // success, failed, pending
  customerOldStatus String?  // Previous customer status before payment (lost, at_risk, risk, new, active, etc.)
  revenuePaymentStatus String? // recovered, lost
  
  // Webhook data
  employeeId        Int?
  businessId        Int?
  
  // Timestamps
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("payment_webhooks")
}

// New Payment Webhook Log Model - Completely Different
model WebhookPaymentLog {
  id                String   @id @default(cuid())
  data              Json     // Store JSON data from webhook body
  createdDate       DateTime @default(now())
  type              String   // payment_checkout
  
  // Timestamps
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("webhook_payment_logs")
}

// Review Rating table - Store customer reviews and ratings
model Review {
  id          String   @id @default(cuid())
  
  // Review details
  rating      Int      // Rating from 1 to 5
  message     String?  // Customer review message/feedback
  status      String   @default("received") // received, processed, responded
  
  // Relations
  customerId  String   // Reference to Customers table
  customer    Customers @relation(fields: [customerId], references: [id], onDelete: Cascade)
  userId      String   // Reference to User table (business owner)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Payment tracking
  paymentWebhookId  String?  // Reference to PaymentWebhook table (which payment triggered this review)
  paymentWebhook    PaymentWebhook? @relation(fields: [paymentWebhookId], references: [id])
  
  // Appointment tracking
  appointmentId     String?  // Reference to Appointment table (which appointment payment this review is for)
  appointment       Appointment? @relation(fields: [appointmentId], references: [id])
  
  // WhatsApp message tracking (optional)
  whatsappMessageId String? // WhatsApp message ID if sent via WhatsApp
  messageStatus     String? @default("sent") // sent, delivered, read, failed
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("reviews")
} 

// WhatsApp Message table - Store customer message Type And bill date
model whatsappMessage {
  id          String   @id @default(cuid())
  
  // Message details
  messageType      String?      // at_risk, lost, recovered
  messageDate      DateTime     @default(now())
  billStatus       Boolean      @default(false)
  billDate         DateTime?
  
  // Relations
  customerId       String       // Reference to Customers table
  customer         Customers    @relation(fields: [customerId], references: [id], onDelete: Cascade)
  userId           String       // Reference to User table (business owner)
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    
  // Timestamps
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  @@map("whatsappMessage")
}

// Payment History Tracking
model PaymentHistory {
  id                String    @id @default(cuid())
  userId            String    // User who made the payment
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Payment Details
  paymentType       String    // 'subscription' or 'simple'
  amount            Float     // Amount paid
  currency          String    // Currency code (USD, ILS, etc.)
  description       String?   // Payment description
  
  // Stripe Details
  stripeSessionId   String?   // Stripe checkout session ID
  stripePaymentId   String?   // Stripe payment intent ID
  stripeSubscriptionId String? // Stripe subscription ID (for subscriptions)
  stripeCustomerId  String?   // Stripe customer ID
  
  // Payment Status
  status            String    // 'pending', 'succeeded', 'failed', 'canceled'
  paymentMethod     String?   // 'card', 'link', etc.
  
  // Metadata
  metadata          Json?     // Additional payment metadata
  source            String?   // 'email_link', 'dashboard', 'api', etc.
  
  // Timestamps
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@map("paymentHistory")
}

// Staff table - Store staff/employee information for businesses
model Staff {
  id          String   @id @default(cuid())
  
  // Staff details
  fullName    String   // Full name of the staff member
  phone       String   // Phone number (required)
  email       String?  // Email address (optional)
  city        String?  // City (optional)
  address     String?  // Address (optional)
  image       String?  // Profile image URL from Cloudinary (optional)
  
  // Business relation
  businessId  String   // Reference to User table (business owner)
  user        User     @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  // Appointments relation
  appointments Appointment[] // Appointments assigned to this staff member
  
  // Operating hours relation
  operatingHours StaffOperatingHours[] // Staff operating hours
  
  // Staff services relation
  staffServices StaffService[] // Services assigned to this staff member
  
  // Waitlist relation
  waitlists    Waitlist[] // Waitlist entries preferring this staff
  
  // Status
  isActive    Boolean  @default(true)
  isDeleted   Boolean  @default(false) // Soft delete flag
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("staff")
}

// Staff Operating Hours table - Store staff hours of operation
model StaffOperatingHours {
  id          String   @id @default(cuid())
  
  // Staff relation
  staffId     String   // Reference to Staff table
  staff       Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  
  // Operating hours details
  day         String?   // Day of the week (e.g., "◊ê'", "◊ë'", "◊í'", "◊ì'", "◊î'", "◊ï'", "◊©'")
  startTime   String?   // Start time (format: "HH:MM")
  endTime     String?   // End time (format: "HH:MM")
  isActive    Boolean?  @default(true) // Active/Inactive toggle
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("staff_operating_hours")
}

// Business Operating Hours table - Store business hours of operation
model BusinessOperatingHours {
  id          String   @id @default(cuid())
  
  // User relation
  userId      String   // Reference to User table
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Operating hours details
  day         String?   // Day of the week (e.g., "◊ê'", "◊ë'", "◊í'", "◊ì'", "◊î'", "◊ï'", "◊©'")
  startTime   String?   // Start time (format: "HH:MM")
  endTime     String?   // End time (format: "HH:MM")
  isActive    Boolean?  @default(true) // Active/Inactive toggle
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("business_operating_hours")
}

// BusinessGallery - Store gallery image references (fileName, fileUrl from Cloudinary) per user
model BusinessGallery {
  id        String   @id @default(cuid())
  fileName  String   // Original file name
  fileUrl   String   // Cloudinary URL for display/delete
  userId    String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("business_gallery")
}

// Client permissions - Booking/scheduling settings per user (linked by userId)
model ClientPermissions {
  id                        String   @id @default(cuid())
  userId                    String   @unique
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  allowOnlineBooking        Boolean  @default(true)
  minAdvanceBookingMinutes  Int      @default(10)   // from CLIENT_PERMISSIONS_TIME_OPTIONS (e.g. 10, 15, 30)
  maxAdvanceBookingMinutes  Int      @default(30240) // from same options (e.g. 10080=1 week, 30240=3 weeks)
  cancelBeforeMinutes       Int      @default(180)  // from same options (e.g. 10, 60, 180=3 hours)
  timeSlotInterval          String   @default("half-hour")  // half-hour, hour, 15-minutes, 30-minutes
  appointmentLimit          String   @default("unlimited") // unlimited, 1, 2, 3, 5, 10
  showServicePrices         Boolean  @default(true)
  showServiceDuration       Boolean  @default(false)
  allowChooseTeamMember     Boolean  @default(true)
  requireBusinessApproval   Boolean  @default(false)
  onlyExistingClients       Boolean  @default(false)
  oneAppointmentOnly        Boolean  @default(true)

  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@map("client_permissions")
}

// Automations - Customer messages & business notification toggles per user (linked by userId)
model Automations {
  id                          String   @id @default(cuid())
  userId                      String   @unique
  user                        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  sendMessageOnAtRisk          Boolean  @default(false)
  sendMessageOnChurned        Boolean  @default(false)
  sendMessageOnPaymentForReview Boolean @default(false)
  notifyOnAtRisk              Boolean  @default(false)
  notifyOnChurned             Boolean  @default(false)
  notifyOnRecovered            Boolean  @default(false)
  notifyOnLowRating           Boolean  @default(false)

  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  @@map("automations")
}

// Service table - Store services/offerings for businesses
model Service {
  id                String   @id @default(cuid())
  
  // Service details
  name              String   // Service name (required)
  notes             String?  // Service notes/description (optional)
  category          String?  // Service category name (optional, kept for backward compatibility)
  categoryId        String?  // Reference to Category table (optional)
  price             Float    // Service price (required)
  duration          Int      // Duration in minutes (required)
  color             String?  // Color code for display (optional, default: #FF257C)
  hideFromClients   Boolean  @default(false) // Hide from client booking (optional)
  
  // Advanced appointment settings
  earliestTimeToBook String? // Earliest time to make an appointment (format: "HH:MM")
  latestTimeToBook   String? // Latest time to make an appointment (format: "HH:MM")
  availableDays      String[] @default([]) // Days when you can make an appointment (array of day names)
  
  // Business relation
  businessId        String   // Reference to User table (business owner)
  user              User     @relation(fields: [businessId], references: [id], onDelete: Cascade)
  
  // Category relation
  categoryRelation  Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  
  // Appointments relation
  appointments      Appointment[] // Appointments using this service
  
  // Staff services relation
  staffServices     StaffService[] // Staff members who provide this service
  
  // Waitlist relation
  waitlists         Waitlist[] // Waiting list entries for this service
  
  // Status
  isActive          Boolean  @default(true)
  isDeleted         Boolean  @default(false) // Soft delete flag
  
  // Timestamps
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("services")
}

// StaffService table - Many-to-many relationship between Staff and Service with price and duration override
model StaffService {
  id              String   @id @default(cuid())
  
  // Relations
  staffId         String   // Reference to Staff table
  staff            Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  serviceId        String   // Reference to Service table
  service          Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  
  // Price override (if null, use service base price)
  priceOverride    Float?   // Custom price for this staff member (optional)
  
  // Duration override (if null, use service base duration in minutes)
  durationOverride String?  // Custom duration string for this staff member (optional, e.g., "30 ◊ì◊ß'", "◊©◊¢◊î")
  
  // Status
  isActive         Boolean  @default(true) // Soft delete flag - never actually delete rows
  
  // Timestamps
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Unique constraint: one staff-service combination
  @@unique([staffId, serviceId])
  @@map("staff_services")
}

// Category table - Store service categories
model Category {
  id          String   @id @default(cuid())
  
  // Category details
  title       String   // Category title (required)
  status      String   @default("active") // active, inactive
  isDeleted   Boolean  @default(false) // Soft delete flag
  
  // Business relation
  userId      String   // Reference to User table (business owner)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Services using this category
  services    Service[]
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("categories")
}

// CatalogCategory table - Store catalog/product categories
model CatalogCategory {
  id          String   @id @default(cuid())
  
  // Category details
  title       String   // Category title (required)
  status      String   @default("active") // active, inactive
  isDeleted   Boolean  @default(false) // Soft delete flag
  
  // Business relation
  userId      String   // Reference to User table (business owner)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("catalog_categories")
}

// Supplier table - Store supplier information for businesses
model Supplier {
  id          String   @id @default(cuid())
  
  // Supplier details
  name        String   // Supplier name (required)
  phone       String?  // Phone number (optional)
  email       String?  // Email address (optional)
  status      String   @default("◊§◊¢◊ô◊ú") // "◊§◊¢◊ô◊ú" (Active) or "◊ú◊ê ◊§◊¢◊ô◊ú" (Inactive)
  
  // Business relation
  userId      String   // Reference to User table (business owner)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Products relation
  products    Product[] // Products supplied by this supplier
  
  // Status
  isDeleted   Boolean  @default(false) // Soft delete flag
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("suppliers")
}

// Product table - Store products in catalog
model Product {
  id                String   @id @default(cuid())
  
  // Product details
  name              String   // Product name (required)
  category          String?  // Product category (optional, can be from CatalogCategory or custom)
  barcode           String?  // Product barcode (optional)
  
  // Pricing
  supplierPrice     Float?   // Price from supplier (optional)
  customerPrice     Float    // Price for customer (required)
  grossProfitPercentage Float? // Calculated gross profit percentage (optional)
  
  // Inventory
  currentQuantity   Int      @default(0) // Current stock quantity
  lowStockThreshold Int      @default(0) // Low stock alert threshold
  reorderQuantity   Int      @default(0) // Reorder quantity
  lowStockAlerts    Boolean  @default(false) // Enable low stock alerts
  
  // Commission
  enableCommission  Boolean  @default(false) // Enable commission for this product
  
  // Supplier relation
  supplierId        String?  // Reference to Supplier table (optional - can be null if no supplier)
  supplier          Supplier? @relation(fields: [supplierId], references: [id], onDelete: SetNull)
  
  // Business relation
  userId            String   // Reference to User table (business owner)
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Status
  status            String   @default("◊§◊¢◊ô◊ú") // "◊§◊¢◊ô◊ú" (Active) or "◊ú◊ê ◊§◊¢◊ô◊ú" (Inactive)
  isDeleted         Boolean  @default(false) // Soft delete flag
  
  // Timestamps
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("products")
}

// Waiting list - Calendar waitlist entries (◊û◊û◊™◊ô◊†◊ô◊ù / ◊§◊í ◊™◊ï◊ß◊£ / ◊†◊ß◊ë◊¢ ◊™◊ï◊®)
model Waitlist {
  id              String   @id @default(cuid())
  
  // Business owner
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Client (customer)
  customerId      String
  customer        Customers @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  // Service requested
  serviceId       String
  service         Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  
  // Preferred staff (optional)
  staffId         String?
  staff           Staff?   @relation(fields: [staffId], references: [id], onDelete: SetNull)
  
  // Requested date/time - matches frontend add flow
  requestedDate   DateTime  // Date user wants appointment
  time            String?   // "any" (◊õ◊ú ◊©◊¢◊î) or specific e.g. "10:00"
  startDateTime   DateTime? // Resolved datetime for sorting (when time is specific)
  
  // Status: waiting | expired | booked (◊û◊û◊™◊ô◊†◊ô◊ù | ◊§◊í ◊™◊ï◊ß◊£ | ◊†◊ß◊ë◊¢ ◊™◊ï◊®)
  status          String   @default("waiting")
  
  // Optional note (e.g. "◊ê◊ó◊® ◊î◊¶◊î◊®◊ô◊ô◊ù ◊ë◊ú◊ë◊ì")
  note            String?
  
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("waitlist")
} 